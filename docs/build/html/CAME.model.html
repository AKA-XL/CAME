

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>CAME.model package &mdash; CAME  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CAME.utils package" href="CAME.utils.html" />
    <link rel="prev" title="CAME.datapair package" href="CAME.datapair.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CAME
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="CAME.html">CAME package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="CAME.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="CAME.datapair.html">CAME.datapair package</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">CAME.model package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-CAME.model.base_layers">CAME.model.base_layers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-CAME.model.cgc">CAME.model.cgc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-CAME.model.cggc">CAME.model.cggc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-CAME.model.heteroframe">CAME.model.heteroframe module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-CAME.model.hidden">CAME.model.hidden module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-CAME.model.loss">CAME.model.loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-CAME.model">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="CAME.utils.html">CAME.utils package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="CAME.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="CAME.html#module-CAME.PARAMETERS">CAME.PARAMETERS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="CAME.html#module-CAME.pipeline">CAME.pipeline module</a></li>
<li class="toctree-l2"><a class="reference internal" href="CAME.html#module-CAME.pipeline_supervised">CAME.pipeline_supervised module</a></li>
<li class="toctree-l2"><a class="reference internal" href="CAME.html#module-CAME">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CAME</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="CAME.html">CAME package</a> &raquo;</li>
        
      <li>CAME.model package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/CAME.model.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="came-model-package">
<h1>CAME.model package<a class="headerlink" href="#came-model-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-CAME.model.base_layers">
<span id="came-model-base-layers-module"></span><h2>CAME.model.base_layers module<a class="headerlink" href="#module-CAME.model.base_layers" title="Permalink to this headline">¶</a></h2>
<p>Created on Mon Aug 24 00:30:14 2020</p>
<p>&#64;author: Xingyan Liu</p>
<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.base_layers.BaseMixConvLayer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.base_layers.</span></span><span class="sig-name descname"><span class="pre">BaseMixConvLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_dim_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dim_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod_kwdicts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layernorm_ntypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sum'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.BaseMixConvLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>Basic one single layer for (cell-gene) graph convolution</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>in_dim_dict</strong> (<em>dict</em><em>[</em><em>str: int</em><em>]</em>) – Input dimensions for each type of nodes.</p></li>
<li><p><strong>out_dim_dict</strong> (<em>dict</em><em>[</em><em>str: int</em><em>]</em>) – Output dimensions for each type of nodes.</p></li>
<li><p><strong>canonical_etypes</strong> (<em>A list of 3-length-tuples:</em><em> (</em><em>ntype_scr</em><em>, </em><em>etype</em><em>, </em><em>ntype_dst</em><em>)</em>) – can be accessed from a <cite>dgl.heterograph.DGLHeteroGraph</cite> object by
<cite>G.canonical_etypes</cite></p></li>
</ul>
</dd>
</dl>
<dl>
<dt>mod_kwdicts: a list of tuples like (etype, kind, kwdict)</dt><dd><p>etype: str, edge-type name.
kind: str, either of ‘gat’ or ‘gcn’.
kwdict: dict.</p>
<blockquote>
<div><p>paramter dict for GNN model for that edge type. If an empty dict
{} is given, model will be built using the defaut parameters.</p>
</div></blockquote>
</dd>
<dt>bias: bool, optional</dt><dd><p>True if bias is added. Default: True</p>
</dd>
<dt>activation: callable, optional</dt><dd><p>Activation function. Default: None</p>
</dd>
</dl>
<p>layernorm_ntypes: Union[Sequence[str], None]</p>
<dl class="simple">
<dt>dropout: float, optional</dt><dd><p>Dropout rate. Default: 0.0</p>
</dd>
<dt>aggregate: Union[str, Callable]</dt><dd><p>Aggregation function for reducing messages from different types of relations.
Default: ‘sum’</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.BaseMixConvLayer.build_biases">
<span class="sig-name descname"><span class="pre">build_biases</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.BaseMixConvLayer.build_biases" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.BaseMixConvLayer.build_layernorm">
<span class="sig-name descname"><span class="pre">build_layernorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layernorm_ntypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">elementwise_affine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.BaseMixConvLayer.build_layernorm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.BaseMixConvLayer.build_mix_conv">
<span class="sig-name descname"><span class="pre">build_mix_conv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mod_kwdicts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.BaseMixConvLayer.build_mix_conv" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>mod_kwdicts: list of tuples, each tuple should be formed as:</dt><dd><p>(canonical_etype, mod_kind, kwdict)</p>
<p>for example:
((‘s_ntype’, ‘etype’, ‘d_ntype’), ‘gat’,
dict(h_dim = 16, n_heads=8, feat_drop=0.05,</p>
<blockquote>
<div><p>attn_drop=0.6, negative_slope=0.2,)</p>
</div></blockquote>
<p>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.BaseMixConvLayer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.BaseMixConvLayer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward computation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<em>DGLHeteroGraph</em>) – Input graph.</p></li>
<li><p><strong>inputs</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>torch.Tensor</em><em>]</em>) – Node feature for each node type.</p></li>
<li><p><strong>**kwds</strong> (<em>ignored</em><em>, </em><em>only for compatibility.</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New node features for each node type.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict[str, torch.Tensor]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.base_layers.BaseMixConvLayer.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.base_layers.BaseMixConvLayer.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.base_layers.GeneralRGCLayer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.base_layers.</span></span><span class="sig-name descname"><span class="pre">GeneralRGCLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_dim_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dim_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">canonical_etypes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'right'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batchnorm_ntypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layernorm_ntypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout_feat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sum'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GeneralRGCLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<dl class="simple">
<dt>A variant of the Relational graph convolution (RGCN) layer,</dt><dd><p>alowing different number dimensions for each node-type.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>in_dim_dict</strong> (<em>Union</em><em>[</em><em>int</em><em>, </em><em>Mapping</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>) – Input dimensions for each node-type</p></li>
<li><p><strong>out_dim_dict</strong> (<em>Union</em><em>[</em><em>int</em><em>, </em><em>Mapping</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>) – Input dimensions for each node-type</p></li>
<li><p><strong>canonical_etypes</strong> (<em>A list of 3-length-tuples:</em><em> (</em><em>ntype_scr</em><em>, </em><em>etype</em><em>, </em><em>ntype_dst</em><em>)</em>) – can be accessed from a <cite>dgl.heterograph.DGLHeteroGraph</cite> object by
<cite>G.canonical_etypes</cite></p></li>
<li><p><strong>norm</strong> (<em>str</em>) – one of ‘right’, ‘left’, ‘both’</p></li>
<li><p><strong>use_weight</strong> (<em>bool</em><em> or </em><em>list</em><em>[</em><em>str</em><em>]</em><em>, </em><em>optional.</em>) – True if a linear layer is applied after message passing. Default: True</p></li>
<li><p><strong>bias</strong> (<em>bool</em><em>, </em><em>optional</em>) – True if bias is added. Default: True</p></li>
<li><p><strong>activation</strong> (<em>callable</em><em>, </em><em>optional</em>) – Activation function. Default: None</p></li>
<li><p><strong>layernorm_ntypes</strong> (<em>Union</em><em>[</em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>, </em><em>None</em><em>]</em>) – </p></li>
<li><p><strong>dropout</strong> (<em>float</em><em>, </em><em>optional</em>) – Dropout rate. Default: 0.0</p></li>
<li><p><strong>aggregate</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>Callable</em><em>]</em>) – Aggregation function for reducing messages from different types of relations.
Default: ‘sum’</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.GeneralRGCLayer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">static_wdict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GeneralRGCLayer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>(GeneralRGCLayer, modified <cite>RelGraphConvLayer</cite>)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<em>DGLHeteroGraph</em>) – Input graph.</p></li>
<li><p><strong>inputs</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>torch.Tensor</em><em>]</em>) – Node feature for each node type.</p></li>
<li><p><strong>etypes</strong> (<em>None</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em>) – if provided, it can be used to subset the edge-types of the graph.</p></li>
<li><p><strong>static_wdict</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>torch.Tensor</em><em>]</em><em>, </em><em>optional</em>) – etype –&gt; <cite>w</cite> of shape (n_edges, )
Optional external weight tensor, this can be the intrinsic weights
of the graph, and is NOT trainable. (for <cite>GraphConvLayer.forward</cite>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New node features for each node type.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict[str, torch.Tensor]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.base_layers.GeneralRGCLayer.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.base_layers.GeneralRGCLayer.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphAttentionLayer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.base_layers.</span></span><span class="sig-name descname"><span class="pre">GraphAttentionLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_heads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feat_drop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attn_drop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative_slope</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">residual</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attn_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mul'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">heads_fuse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GraphAttentionLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>Modified version of <cite>dgl.nn.GATConv</cite>
* message passing with attentions.
* directed and assymetric message passing, allowing different dmensions</p>
<blockquote>
<div><p>of source and destination node-features.</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphAttentionLayer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_attn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GraphAttentionLayer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute graph attention network layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>graph</strong> (<em>DGLGraph</em>) – The graph.</p></li>
<li><p><strong>feat</strong> (<em>torch.Tensor</em><em> or </em><em>pair of torch.Tensor</em>) – If a torch.Tensor is given, the input feature of shape <span class="math notranslate nohighlight">\((N, D_{in})\)</span> where
<span class="math notranslate nohighlight">\(D_{in}\)</span> is size of input feature, <span class="math notranslate nohighlight">\(N\)</span> is the number of nodes.
If a pair of torch.Tensor is given, the pair must contain two tensors of shape
<span class="math notranslate nohighlight">\((N_{in}, D_{in_{src}})\)</span> and <span class="math notranslate nohighlight">\((N_{out}, D_{in_{dst}})\)</span>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The output feature of shape <span class="math notranslate nohighlight">\((N, H, D_{out})\)</span> where <span class="math notranslate nohighlight">\(H\)</span>
is the number of heads, and <span class="math notranslate nohighlight">\(D_{out}\)</span> is size of output feature.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphAttentionLayer.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GraphAttentionLayer.reset_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Reinitialize learnable parameters.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphAttentionLayer.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.base_layers.GraphAttentionLayer.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphConvLayer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.base_layers.</span></span><span class="sig-name descname"><span class="pre">GraphConvLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'left'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GraphConvLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p class="rubric">Notes</p>
<ul class="simple">
<li><dl class="simple">
<dt>simliar to <cite>dgl.nn.GraphConv</cite>, while normalization can be ‘left’, which</dt><dd><p>is not allowed in <cite>dgl.nn.GraphConv</cite>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>directed and assymetric message passing, allowing different dmensions</dt><dd><p>of source and distinate node-features.</p>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>in_dim</strong> (<em>int</em>) – Input feature size.</p></li>
<li><p><strong>out_dim</strong> (<em>int</em>) – Output feature size.</p></li>
<li><p><strong>norm</strong> (<em>str</em><em>, </em><em>optional</em>) – How to apply the normalizer. If is <cite>‘right’</cite>, divide the aggregated messages
by each node’s in-degrees, which is equivalent to averaging the received messages.
If is <cite>‘none’</cite>, no normalization is applied. Default is <cite>‘both’</cite>,
where the <span class="math notranslate nohighlight">\(c_{ij}\)</span> in the paper is applied.</p></li>
<li><p><strong>weight</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, apply a linear layer. Otherwise, aggregating the messages
without a weight matrix.</p></li>
<li><p><strong>bias</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, adds a learnable bias to the output. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>activation</strong> (<em>callable activation function/layer</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – If not None, applies an activation function to the updated node features.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphConvLayer.weight">
<span class="sig-name descname"><span class="pre">weight</span></span><a class="headerlink" href="#CAME.model.base_layers.GraphConvLayer.weight" title="Permalink to this definition">¶</a></dt>
<dd><p>The learnable weight tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphConvLayer.bias">
<span class="sig-name descname"><span class="pre">bias</span></span><a class="headerlink" href="#CAME.model.base_layers.GraphConvLayer.bias" title="Permalink to this definition">¶</a></dt>
<dd><p>The learnable bias tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphConvLayer.extra_repr">
<span class="sig-name descname"><span class="pre">extra_repr</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GraphConvLayer.extra_repr" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the extra representation of the module,
which will come into effect when printing the model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphConvLayer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">static_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GraphConvLayer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>(modified GCN)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<em>DGLGraph</em>) – The graph.</p></li>
<li><p><strong>feat</strong> (<em>torch.Tensor</em>) – The input feature</p></li>
<li><p><strong>weight</strong> (<em>torch.Tensor</em><em>, </em><em>optional</em>) – Optional external weight tensor.</p></li>
<li><p><strong>static_weight</strong> (<em>torch.Tensor of shape</em><em> (</em><em>n_edges</em><em>, </em><em>)</em><em>, </em><em>optional</em>) – Optional external weight tensor, this can be the intrinsic weights
of the graph, and is NOT trainable.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The output feature</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphConvLayer.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.GraphConvLayer.reset_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Reinitialize learnable parameters.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.base_layers.GraphConvLayer.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.base_layers.GraphConvLayer.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.base_layers.HeteroLayerNorm">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.base_layers.</span></span><span class="sig-name descname"><span class="pre">HeteroLayerNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_dim_dict</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.HeteroLayerNorm" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>LayerNorm for different type of nodes</p>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.HeteroLayerNorm.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">h_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.HeteroLayerNorm.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within
this function, one should call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards
instead of this since the former takes care of running the
registered hooks while the latter silently ignores them.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.base_layers.HeteroLayerNorm.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.base_layers.HeteroLayerNorm.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.base_layers.RelGraphConvLayer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.base_layers.</span></span><span class="sig-name descname"><span class="pre">RelGraphConvLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel_names</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'right'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layernorm_ntypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sum'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.RelGraphConvLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>Relational graph convolution layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>in_dim</strong> (<em>int</em>) – Input feature size.</p></li>
<li><p><strong>out_dim</strong> (<em>int</em>) – Output feature size.</p></li>
<li><p><strong>rel_names</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – Relation names.</p></li>
<li><p><strong>num_bases</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of bases. If is none, use number of relations. Default: None.</p></li>
<li><p><strong>use_weight</strong> (<em>bool</em><em> or </em><em>list</em><em>[</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – True if a linear layer is applied after message passing. Default: True</p></li>
<li><p><strong>bias</strong> (<em>bool</em><em>, </em><em>optional</em>) – True if bias is added. Default: True</p></li>
<li><p><strong>activation</strong> (<em>callable</em><em>, </em><em>optional</em>) – Activation function. Default: None</p></li>
<li><p><strong>self_loop</strong> (<em>bool</em><em>, </em><em>optional</em>) – True to include self loop message. Default: False</p></li>
<li><p><strong>dropout</strong> (<em>float</em><em>, </em><em>optional</em>) – Dropout rate. Default: 0.0</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.base_layers.RelGraphConvLayer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.base_layers.RelGraphConvLayer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward computation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<em>DGLHeteroGraph</em>) – Input graph.</p></li>
<li><p><strong>inputs</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>torch.Tensor</em><em>]</em>) – Node feature for each node type.</p></li>
<li><p><strong>etypes</strong> (<em>None</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New node features for each node type.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict[str, torch.Tensor]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.base_layers.RelGraphConvLayer.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.base_layers.RelGraphConvLayer.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-CAME.model.cgc">
<span id="came-model-cgc-module"></span><h2>CAME.model.cgc module<a class="headerlink" href="#module-CAME.model.cgc" title="Permalink to this headline">¶</a></h2>
<p>Created on Tue Mar 16 14:11:14 2021</p>
<p>&#64;author: Xingyan Liu</p>
<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.cgc.CGCNet">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.cgc.</span></span><span class="sig-name descname"><span class="pre">CGCNet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cgc.CGCNet" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#CAME.model.cggc.CGGCNet" title="CAME.model.cggc.CGGCNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">CAME.model.cggc.CGGCNet</span></code></a></p>
<p>(used when features are 1-to-1 aligned)</p>
<p>Graph Convolutional Network for cell-gene Heterogenous graph,
with edges named as:</p>
<blockquote>
<div><p>(‘cell’, ‘express’, ‘gene’):        cg_net,
(‘gene’, ‘expressed_by’, ‘cell’):   cg_net.T,
(‘cell’, ‘self_loop_cell’, ‘cell’): sparse.eye(n_cells),</p>
</div></blockquote>
<ul class="simple">
<li><p>gene embeddings are computed from cells;</p></li>
<li><dl class="simple">
<dt>weight sharing across hidden layers is allowed by setting</dt><dd><p><cite>share_hidden_weights=True</cite></p>
</dd>
</dl>
</li>
<li><p>attention can be applied on the last layer (<cite>self.cell_classifier</cite>);</p></li>
<li><p>the graph for the embedding layer and the hidden layers can be different;</p></li>
<li><p>allow expression values as static edge weights. (but seems not work…)</p></li>
</ul>
<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.cgc.CGCNet.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.cgc.CGCNet.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CAME.model.cgc.detach2numpy">
<span class="sig-prename descclassname"><span class="pre">CAME.model.cgc.</span></span><span class="sig-name descname"><span class="pre">detach2numpy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cgc.detach2numpy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-CAME.model.cggc">
<span id="came-model-cggc-module"></span><h2>CAME.model.cggc module<a class="headerlink" href="#module-CAME.model.cggc" title="Permalink to this headline">¶</a></h2>
<p>Created on Sat Mar 20 18:59:29 2021</p>
<p>&#64;author: Xingyan Liu</p>
<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.cggc.</span></span><span class="sig-name descname"><span class="pre">CGGCNet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g_or_canonical_etypes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">in_dim_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h_dim_add</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_hidden_layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'right'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout_feat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative_slope</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batchnorm_ntypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layernorm_ntypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel_names_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">share_hidden_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attn_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwdict_outgat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">share_layernorm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">residual</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>Graph Convolutional Network for cell-gene Heterogenous graph,
with edges named as:</p>
<blockquote>
<div><p>(‘cell’, ‘express’, ‘gene’):        cg_net,
(‘gene’, ‘expressed_by’, ‘cell’):   cg_net.T,
(‘gene’, ‘homolog_with’, ‘gene’):   gg_net + sparse.eye(n_gnodes),
(‘cell’, ‘self_loop_cell’, ‘cell’):      sparse.eye(n_cells),</p>
</div></blockquote>
<ul class="simple">
<li><p>gene embeddings are computed from cells;</p></li>
<li><dl class="simple">
<dt>weight sharing across hidden layers is allowed by setting</dt><dd><p><cite>share_hidden_weights=True</cite></p>
</dd>
</dl>
</li>
<li><p>attention can be applied on the last layer (<cite>self.cell_classifier</cite>);</p></li>
<li><p>the graph for the embedding layer and the hidden layers can be different;</p></li>
<li><p>allow expression values as static edge weights. (but seems not work…)</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.build_cell_classifier">
<span class="sig-name descname"><span class="pre">build_cell_classifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kwdict_gat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.build_cell_classifier" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.build_embed_layer">
<span class="sig-name descname"><span class="pre">build_embed_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.build_embed_layer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within
this function, one should call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards
instead of this since the former takes care of running the
registered hooks while the latter silently ignores them.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.get_attentions">
<span class="sig-name descname"><span class="pre">get_attentions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fuse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.get_attentions" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>output:</dt><dd><p>cell-by-gene attention matrix</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.get_classification_loss">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">get_classification_loss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out_cell</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_reduction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.get_classification_loss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.get_hidden_states">
<span class="sig-name descname"><span class="pre">get_hidden_states</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i_layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detach2np</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.get_hidden_states" title="Permalink to this definition">¶</a></dt>
<dd><p>detach2np: whether tensors be detached and transformed into numpy.ndarray</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.get_out_logits">
<span class="sig-name descname"><span class="pre">get_out_logits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.get_out_logits" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.make_out_gat">
<span class="sig-name descname"><span class="pre">make_out_gat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kwdict_gat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.make_out_gat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.make_out_gcn">
<span class="sig-name descname"><span class="pre">make_out_gcn</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.CGGCNet.make_out_gcn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.cggc.CGGCNet.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.cggc.CGGCNet.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CAME.model.cggc.detach2numpy">
<span class="sig-prename descclassname"><span class="pre">CAME.model.cggc.</span></span><span class="sig-name descname"><span class="pre">detach2numpy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.cggc.detach2numpy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-CAME.model.heteroframe">
<span id="came-model-heteroframe-module"></span><h2>CAME.model.heteroframe module<a class="headerlink" href="#module-CAME.model.heteroframe" title="Permalink to this headline">¶</a></h2>
<p>Heterograph NN modules</p>
<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.heteroframe.HeteroGraphConv">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.heteroframe.</span></span><span class="sig-name descname"><span class="pre">HeteroGraphConv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mods</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sum'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.heteroframe.HeteroGraphConv" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>A generic module for computing convolution on heterogeneous graphs.</p>
<p>The heterograph convolution applies sub-modules on their associating
relation graphs, which reads the features from source nodes and writes the
updated ones to destination nodes. If multiple relations have the same
destination node types, their results are aggregated by the specified method.</p>
<p>If the relation graph has no edge, the corresponding module will not be called.</p>
<p class="rubric">Examples</p>
<p>Create a heterograph with three types of relations and nodes.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dgl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">heterograph</span><span class="p">({</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;follows&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span> <span class="p">:</span> <span class="n">edges1</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;plays&#39;</span><span class="p">,</span> <span class="s1">&#39;game&#39;</span><span class="p">)</span> <span class="p">:</span> <span class="n">edges2</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;sells&#39;</span><span class="p">,</span> <span class="s1">&#39;game&#39;</span><span class="p">)</span>  <span class="p">:</span> <span class="n">edges3</span><span class="p">})</span>
</pre></div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">HeteroGraphConv</span></code> that applies different convolution modules to
different relations. Note that the modules for <code class="docutils literal notranslate"><span class="pre">'follows'</span></code> and <code class="docutils literal notranslate"><span class="pre">'plays'</span></code>
do not share weights.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dgl.nn.pytorch</span> <span class="k">as</span> <span class="nn">dglnn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conv</span> <span class="o">=</span> <span class="n">dglnn</span><span class="o">.</span><span class="n">HeteroGraphConv</span><span class="p">({</span>
<span class="gp">... </span>    <span class="s1">&#39;follows&#39;</span> <span class="p">:</span> <span class="n">dglnn</span><span class="o">.</span><span class="n">GraphConv</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="gp">... </span>    <span class="s1">&#39;plays&#39;</span> <span class="p">:</span> <span class="n">dglnn</span><span class="o">.</span><span class="n">GraphConv</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="gp">... </span>    <span class="s1">&#39;sells&#39;</span> <span class="p">:</span> <span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">(</span><span class="o">...</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Call forward with some <code class="docutils literal notranslate"><span class="pre">'user'</span></code> features. This computes new features for both
<code class="docutils literal notranslate"><span class="pre">'user'</span></code> and <code class="docutils literal notranslate"><span class="pre">'game'</span></code> nodes.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch</span> <span class="k">as</span> <span class="nn">th</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span> <span class="p">:</span> <span class="n">th</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">),</span> <span class="mi">5</span><span class="p">))}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h2</span> <span class="o">=</span> <span class="n">conv</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">h2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">dict_keys([&#39;user&#39;, &#39;game&#39;])</span>
</pre></div>
</div>
<p>Call forward with both <code class="docutils literal notranslate"><span class="pre">'user'</span></code> and <code class="docutils literal notranslate"><span class="pre">'store'</span></code> features. Because both the
<code class="docutils literal notranslate"><span class="pre">'plays'</span></code> and <code class="docutils literal notranslate"><span class="pre">'sells'</span></code> relations will update the <code class="docutils literal notranslate"><span class="pre">'game'</span></code> features,
their results are aggregated by the specified method (i.e., summation here).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span> <span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span> <span class="p">:</span> <span class="o">...</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f2</span> <span class="o">=</span> <span class="n">conv</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">dict_keys([&#39;user&#39;, &#39;game&#39;])</span>
</pre></div>
</div>
<p>Call forward with some <code class="docutils literal notranslate"><span class="pre">'store'</span></code> features. This only computes new features
for <code class="docutils literal notranslate"><span class="pre">'game'</span></code> nodes.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;store&#39;</span> <span class="p">:</span> <span class="o">...</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span> <span class="o">=</span> <span class="n">conv</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">g1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">dict_keys([&#39;game&#39;])</span>
</pre></div>
</div>
<p>Call forward with a pair of inputs is allowed and each submodule will also
be invoked with a pair of inputs.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x_src</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span> <span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span> <span class="p">:</span> <span class="o">...</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x_dst</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span> <span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;game&#39;</span> <span class="p">:</span> <span class="o">...</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y_dst</span> <span class="o">=</span> <span class="n">conv</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="n">x_src</span><span class="p">,</span> <span class="n">x_dst</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">y_dst</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">dict_keys([&#39;user&#39;, &#39;game&#39;])</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mods</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>nn.Module</em><em>]</em>) – Modules associated with every edge types. The forward function of each
module must have a <cite>DGLHeteroGraph</cite> object as the first argument, and
its second argument is either a tensor object representing the node
features or a pair of tensor object representing the source and destination
node features.</p></li>
<li><p><strong>aggregate</strong> (<em>str</em><em>, </em><em>callable</em><em>, </em><em>optional</em>) – <p>Method for aggregating node features generated by different relations.
Allowed string values are ‘sum’, ‘max’, ‘min’, ‘mean’, ‘stack’.
The ‘stack’ aggregation is performed along the second dimension, whose order
is deterministic.
User can also customize the aggregator by providing a callable instance.
For example, aggregation by summation is equivalent to the follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_agg_func</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">dsttype</span><span class="p">):</span>
    <span class="c1"># tensors: is a list of tensors to aggregate</span>
    <span class="c1"># dsttype: string name of the destination node type for which the</span>
    <span class="c1">#          aggregation is performed</span>
    <span class="n">stacked</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">stacked</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.heteroframe.HeteroGraphConv.mods">
<span class="sig-name descname"><span class="pre">mods</span></span><a class="headerlink" href="#CAME.model.heteroframe.HeteroGraphConv.mods" title="Permalink to this definition">¶</a></dt>
<dd><p>Modules associated with every edge types.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict[str, nn.Module]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.heteroframe.HeteroGraphConv.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod_args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.heteroframe.HeteroGraphConv.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward computation</p>
<p>Invoke the forward function with each module and aggregate their results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<em>DGLHeteroGraph</em>) – Graph data.</p></li>
<li><p><strong>inputs</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Tensor</em><em>] or </em><em>pair of dict</em><em>[</em><em>str</em><em>, </em><em>Tensor</em><em>]</em>) – Input node features.</p></li>
<li><p><strong>mod_args</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>tuple</em><em>[</em><em>any</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – Extra positional arguments for the sub-modules.</p></li>
<li><p><strong>mod_kwargs</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>[</em><em>str</em><em>, </em><em>any</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – Extra key-word arguments for the sub-modules.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Output representations for every types of nodes.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict[str, Tensor]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.heteroframe.HeteroGraphConv.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.heteroframe.HeteroGraphConv.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-CAME.model.hidden">
<span id="came-model-hidden-module"></span><h2>CAME.model.hidden module<a class="headerlink" href="#module-CAME.model.hidden" title="Permalink to this headline">¶</a></h2>
<p>Created on Sun Apr 11 18:42:39 2021</p>
<p>&#64;author: Xingyan Liu</p>
<div class="section" id="hidden-layers-not-including-the-embedding-layer">
<h3>Hidden layers (not including the embedding layer)<a class="headerlink" href="#hidden-layers-not-including-the-embedding-layer" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.hidden.HiddenRGCN">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.hidden.</span></span><span class="sig-name descname"><span class="pre">HiddenRGCN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">canonical_etypes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h_dim</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_hidden_layers</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'right'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weight</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative_slope</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batchnorm_ntypes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layernorm_ntypes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">share_layernorm</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activate_out</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.hidden.HiddenRGCN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>NOT sharing parameters across hidden layers</p>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.hidden.HiddenRGCN.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.hidden.HiddenRGCN.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>No copies made for h_dict, so make sure the forward functions do not
make any changes directly on the h_dict !</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.hidden.HiddenRGCN.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.hidden.HiddenRGCN.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.hidden.HiddenRRGCN">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.hidden.</span></span><span class="sig-name descname"><span class="pre">HiddenRRGCN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">canonical_etypes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h_dim</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_hidden_layers</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dim</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'right'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative_slope</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batchnorm_ntypes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layernorm_ntypes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">share_layernorm</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.hidden.HiddenRRGCN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>sharing parameters across hidden layers, so that the dimensions for
each layer should be the same.</p>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.hidden.HiddenRRGCN.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g_or_blocks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.hidden.HiddenRRGCN.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>No copies made for h_dict, so make sure the forward functions do not
make any changes directly on the h_dict !</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.hidden.HiddenRRGCN.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.hidden.HiddenRRGCN.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-CAME.model.loss">
<span id="came-model-loss-module"></span><h2>CAME.model.loss module<a class="headerlink" href="#module-CAME.model.loss" title="Permalink to this headline">¶</a></h2>
<p>Created on Sun Apr 11 18:46:19 2021</p>
<p>&#64;author: Xingyan Liu</p>
<dl class="py class">
<dt class="sig sig-object py" id="CAME.model.loss.LabelSmoothingCrossEntropy">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">CAME.model.loss.</span></span><span class="sig-name descname"><span class="pre">LabelSmoothingCrossEntropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.loss.LabelSmoothingCrossEntropy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="CAME.model.loss.LabelSmoothingCrossEntropy.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.loss.LabelSmoothingCrossEntropy.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within
this function, one should call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards
instead of this since the former takes care of running the
registered hooks while the latter silently ignores them.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="CAME.model.loss.LabelSmoothingCrossEntropy.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#CAME.model.loss.LabelSmoothingCrossEntropy.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CAME.model.loss.multilabel_binary_cross_entropy">
<span class="sig-prename descclassname"><span class="pre">CAME.model.loss.</span></span><span class="sig-name descname"><span class="pre">multilabel_binary_cross_entropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logits</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">torch.Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">torch.Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">torch.Tensor</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CAME.model.loss.multilabel_binary_cross_entropy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-CAME.model">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-CAME.model" title="Permalink to this headline">¶</a></h2>
<p>Created on Sun Dec 27 21:59:44 2020</p>
<p>&#64;author: Xingyan Liu</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="CAME.utils.html" class="btn btn-neutral float-right" title="CAME.utils package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="CAME.datapair.html" class="btn btn-neutral float-left" title="CAME.datapair package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Academy of Mathematics and Systems Science, CAS.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>